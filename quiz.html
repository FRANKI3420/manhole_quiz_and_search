<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>マンホール蓋クイズ (10択)</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f2f5;
            text-align: center;
        }

        .quiz-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .crop-image-area {
            margin: 20px auto;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            overflow: hidden;
            border: 5px solid #007bff;
            background: #eee;
        }

        .crop-image-area img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* 10択なので2列から3列に変更してスッキリさせます */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 12px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: #fff;
            transition: 0.2s;
        }

        button:hover {
            background: #e9ecef;
        }

        button.correct {
            background: #28a745 !important;
            border-color: #28a745;
            color: white;
        }

        button.wrong {
            background: #dc3545 !important;
            border-color: #dc3545;
            color: white;
        }

        #result-message {
            font-size: 20px;
            font-weight: bold;
            margin: 20px 0;
            min-height: 30px;
        }

        .next-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 40px;
            margin-top: 20px;
            cursor: pointer;
            border-radius: 5px;
            display: none;
        }

        .card-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }
    </style>
</head>

<body>

    <h1>マンホール蓋クイズ</h1>
    <p>このデザインはどこの自治体でしょうか？（10択）</p>

    <div class="quiz-container">
        <div class="crop-image-area">
            <img id="quizImage" src="" alt="クイズ画像">
        </div>

        <div id="result-message"></div>

        <div id="options" class="options-grid"></div>

        <button id="nextBtn" class="next-btn" onclick="startQuiz()">次の問題へ</button>

        <div id="answerInfo" class="card-info">
            <h3>正解：<span id="correctCity"></span></h3>
            <p><span id="correctPref"></span> / <span id="correctEd"></span></p>
            <img id="originalCard" src=""
                style="width: 240px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        </div>
    </div>

    <script>
        let masterData = [];
        const CROP_DIR = "manhole_crops/";

        fetch('master_data.json')
            .then(res => res.json())
            .then(data => {
                masterData = data;
                startQuiz();
            });

        function startQuiz() {
            document.getElementById('result-message').textContent = "";
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('answerInfo').style.display = 'none';
            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = "";

            // 1. 正解を選ぶ
            const correctData = masterData[Math.floor(Math.random() * masterData.length)];

            // 2. 画像を表示（修正ポイント：テンプレートリテラルの空白を削除）
            document.getElementById('quizImage').src = `${CROP_DIR}${correctData.city}.png`;

            // 3. 選択肢を10個作る (正解1 + 不正解9)
            let dummyData = masterData.filter(d => d.city !== correctData.city);
            let choices = [correctData];

            // 不正解を9個ランダムに抽出
            for (let i = 0; i < 9; i++) {
                if (dummyData.length > 0) {
                    const idx = Math.floor(Math.random() * dummyData.length);
                    choices.push(dummyData.splice(idx, 1)[0]);
                }
            }

            // 4. シャッフル
            choices.sort(() => Math.random() - 0.5);

            // 5. ボタン作成
            choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.textContent = choice.city;
                btn.onclick = () => checkAnswer(btn, choice.city, correctData);
                optionsDiv.appendChild(btn);
            });
        }

        function checkAnswer(selectedBtn, selectedCity, correctData) {
            const buttons = document.querySelectorAll('#options button');
            buttons.forEach(btn => btn.disabled = true);

            const msg = document.getElementById('result-message');

            if (selectedCity === correctData.city) {
                msg.textContent = "正解！お見事！";
                msg.style.color = "#28a745";
                selectedBtn.classList.add('correct');
            } else {
                msg.textContent = `残念！正解は ${correctData.city} でした。`;
                msg.style.color = "#dc3545";
                selectedBtn.classList.add('wrong');
                buttons.forEach(btn => {
                    if (btn.textContent === correctData.city) btn.classList.add('correct');
                });
            }

            document.getElementById('correctCity').textContent = correctData.city;
            document.getElementById('correctPref').textContent = correctData.pref;
            document.getElementById('correctEd').textContent = correctData.edition;
            document.getElementById('originalCard').src = correctData.url;
            document.getElementById('answerInfo').style.display = 'block';
            document.getElementById('nextBtn').style.display = 'inline-block';
        }
    </script>
</body>

</html>