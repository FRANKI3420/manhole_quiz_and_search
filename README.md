# マンホールカード・ラボ (Manhole Card Lab)

マンホールカードのデザインをAIで解析し、類似デザインの検索や、切り抜き画像を使ったクイズを楽しめるWebシステムです。

## 📁 ディレクトリ構成とファイル説明

### 🌐 フロントエンド (Web公開用)
GitHub Pages等でホスティングし、ブラウザからアクセスするファイル群です。
* **`index.html`**
    - ポータル画面。類似検索かクイズかのモード選択を行います。
* **`search.html`**
    - 類似デザイン検索画面。1,100枚以上のカードから似たデザインをAIが即座に提案します。
* **`quiz.html`**
    - マンホール蓋クイズ。蓋のデザインだけで自治体を当てる、マニア向けの10択クイズです。
* **`master_data.json`**
    - 全カードの基本情報（自治体、都道府県、弾数、画像URL）を格納したデータベース。
* **`similarity_index.json`**
    - 特徴抽出によって計算された、各カードごとの類似カードTOP10リスト。

---

### 🐍 データ収集・加工スクリプト (Python)
ローカル環境でデータを準備・解析するためのツール群です。

#### 1. データ取得
* **`getCardInfo.py`**
    - Webサイト等からマンホールカードの情報を収集するスクレイピング用スクリプト。
* **`dl_image.py`**
    - 管理リスト（CSV）内のURLを元に、カード画像をローカルに一括ダウンロードします。

#### 2. 画像処理
* **`test_single_crop.py`**
    - 切り抜き位置（中心座標・半径）を調整するためのテスト用プレビュー出力スクリプト。
* **`crop_to_circle.py`**
    - `manhole_images` 内の全画像を、テストで決定した座標に基づいて円形に一括切り抜きします。

#### 3. 解析・データ変換
* **`build_search_index.py`**
    - 特徴抽出モデル（MobileNetV2）を使用し、全画像のベクトル化および類似度計算を行い、検索用インデックスを生成します。
* **`convert_csv_to_master_json.py`**
    - CSVデータをWeb用のJSON形式に変換。弾数の表記ゆれ（第1弾 vs 第01弾）の自動補正機能を含みます。

#### 4. ユーティリティ
* **`check_files.py`**
    - 画像の有無やJSONとの整合性を確認するためのメンテナンス用ツール。

---

### 📂 データ・環境
* **`manhole_images/`**
    - ダウンロードしたオリジナルのカード画像（JPG/PNG）を格納するディレクトリ。
* **`manhole_crops/`**
    - クイズや検索に使用する、円形に切り抜かれた蓋のみの画像（PNG）を格納。
* **`manhole_list.csv`**
    - すべてのカード情報のマスタとなる管理リスト。
* **`venv/`**
    - Pythonの仮想環境ディレクトリ。

---

## 🚀 開発・更新ワークフロー

1. **データ収集**: `runGetCardInfo.sh` で情報を取得し、`dl_image.py` で画像を保存。
2. **画像加工**: `test_single_crop.py` で座標を決定し、`crop_to_circle.py` で一括切り抜き。
3. **AI解析**: `build_search_index.py` を実行し、類似度データベースを生成。
4. **JSON変換**: `convert_csv_to_master_json.py` でフロントエンド用データを最新化。
5. **デプロイ**: HTML, JSON, および `manhole_crops` フォルダを GitHub Pages にアップロード。

---
&copy; 2026 Manhole Card Fan Project